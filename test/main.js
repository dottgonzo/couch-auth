"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var chai = require("chai");
var index_1 = require("../index");
var rpj = require('request-promise-json');
var spawnPouchdbServer = require('spawn-pouchdb-server');
var testport = 8742;
var user0 = {
    user: 'testuser0',
    password: 'testpassw0',
    email: 'testuser0@test.tst'
};
var user1 = {
    user: 'testuser1',
    password: 'testpassw1',
    email: 'testuser1@test.tst'
};
var expect = chai.expect;
var Server;
var CouchAuth;
before(function (done) {
    this.timeout(20000);
    spawnPouchdbServer({
        port: testport,
        backend: false,
        config: {
            admins: { "adminuser": "adminpass" },
            file: false
        },
        log: {
            file: false,
            level: 'info'
        }
    }, function (error, server) {
        if (error) {
            throw error;
        }
        else {
            Server = server;
            CouchAuth = new index_1.default({
                hostname: 'localhost',
                protocol: 'http',
                port: testport,
                user: 'adminuser',
                password: 'adminpass'
            });
            setTimeout(function () {
                done();
            }, 1000);
        }
    });
});
describe("test app_main", function () {
    this.timeout(20000);
    it("verificate presence of app_main db", function (done) {
        rpj.get(CouchAuth.my('app_main')).then(function (d) {
            rpj.put(CouchAuth.my('app_main') + '/testdoctobepresent0', { _id: 'testdoctobepresent0', ee: true }).then(function (d) {
                expect(d).to.be.ok;
                expect(d).to.be.an('object');
                done();
            }).catch(function (err) {
                console.log(err);
                done(Error(err));
            });
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("verificate that app_main db is private", function (done) {
        rpj.put(CouchAuth.publink + '/app_main/testdocnotbepresent0', { _id: 'testdocnotbepresent0', ee: true }).then(function (d) {
            done(Error(d));
        }).catch(function (err) {
            expect(err).to.be.ok;
            done();
        });
    });
    it("verificate admin user", function (done) {
        rpj.get(CouchAuth.my('_users/org.couchdb.user:' + 'adminuser')).then(function (d) {
            expect(d).to.be.ok;
            expect(d).to.have.property('name').that.eq('adminuser');
            expect(d).to.have.property('email');
            expect(d).to.have.property('roles').that.is.an('array');
            expect(d).to.have.property('db').that.is.an('array');
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
});
describe("create a new app", function () {
    it("main admin add first app", function (done) {
        CouchAuth.createapp('testapp').then(function (d) {
            expect(d).to.be.ok;
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
});
describe("users", function () {
    describe("registration", function () {
        var slave;
        it("create an user", function (done) {
            CouchAuth.register({ username: user0.user, password: user0.password, email: user0.email, app_id: 'testapp' }).then(function () {
                rpj.get(CouchAuth.my('_users/org.couchdb.user:' + user0.user)).then(function (d) {
                    expect(d).to.be.ok;
                    expect(d).to.have.property('name').that.eq(user0.user);
                    expect(d).to.have.property('email').that.eq(user0.email);
                    expect(d).to.have.property('roles').that.is.an('array');
                    expect(d.roles[0]).to.be.eq('user');
                    expect(d).to.have.property('type').that.eq('user');
                    expect(d).to.have.property('db').that.is.an('array');
                    expect(d.db[0]).to.have.property('app_id').that.is.a('string').that.eq('testapp');
                    expect(d.db[0]).to.have.property('dbname').that.is.a('string');
                    expect(d.db[0]).to.have.property('dbtype').that.is.a('string').that.eq('mine');
                    expect(d.db[0]).to.have.property('roles').that.is.an('array');
                    expect(d.db[0].roles[0]).to.be.eq('owner');
                    expect(d.db[0]).to.have.property('slave').that.is.an('object');
                    expect(d.db[0].slave).to.have.property('username').that.is.a('string');
                    expect(d.db[0].slave).to.have.property('password').that.is.a('string');
                    slave = d.db[0].slave;
                    done();
                }).catch(function (err) {
                    done(Error(err));
                });
            }).catch(function (err) {
                done(Error(err));
            });
        });
        it("check slave", function (done) {
            rpj.get(CouchAuth.my('_users/org.couchdb.user:' + slave.username)).then(function (d) {
                expect(d).to.be.ok;
                expect(d).to.have.property('name').that.eq(slave.username);
                expect(d).to.have.property('roles').that.is.an('array');
                expect(d.roles[0]).to.be.eq('slave');
                expect(d).to.have.property('app').that.is.an('object');
                expect(d.app).to.have.property('db').that.is.a('string');
                expect(d.app).to.have.property('user').that.is.a('string');
                expect(d).to.have.property('dbtype').that.is.a('string').that.eq('userslave');
                expect(d).to.have.property('type').that.is.a('string').that.eq('user');
                done();
            }).catch(function (err) {
                done(Error(err));
            });
        });
        it("can login", function (done) {
            CouchAuth.login({ username: user0.user, password: user0.password, app_id: 'testapp' }).then(function () {
                done();
            }).catch(function (err) {
                done(Error(err));
            });
        });
    });
    describe("machine", function () {
        it("create a machine for an app subscribed", function (done) {
            done();
        });
        it("can't create a machine for an app that not subscribed yet", function (done) {
            done();
        });
        it("share a machine that own", function (done) {
            done();
        });
        it("can't share a machine that not own", function (done) {
            done();
        });
        it("change a user role for a machine that own", function (done) {
            done();
        });
        it("can't change  a user role for a machine that not own", function (done) {
            done();
        });
        it("delete a machine that own", function (done) {
            done();
        });
        it("can't delete a machine that not own", function (done) {
            done();
        });
    });
});
after(function (done) {
    Server.stop(function () {
        done();
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QkFFbkQsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUVyRCxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUM7b0JBQ2xGLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQy9ELE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFFL0UsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDOUQsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBRTNDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7b0JBQy9ELE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUN2RSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFFdkUsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO29CQUN0QixJQUFJLEVBQUUsQ0FBQztnQkFJWCxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHO29CQUNULElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDckIsQ0FBQyxDQUFDLENBQUE7WUFDTixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHO2dCQUNULElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNyQixDQUFDLENBQUMsQ0FBQTtRQUlOLENBQUMsQ0FBQyxDQUFBO1FBRUYsRUFBRSxDQUFDLGFBQWEsRUFBRSxVQUFVLElBQUk7WUFFNUIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLDBCQUEwQixHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUM7Z0JBRXRFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztnQkFFbkIsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2dCQUUzRCxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQ3hELE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBR3JDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDdkQsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDekQsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFFM0QsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBRTlFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUV2RSxJQUFJLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLEdBQUc7Z0JBQ1QsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLENBQUMsQ0FBQyxDQUFBO1FBSU4sQ0FBQyxDQUFDLENBQUE7UUFFRixFQUFFLENBQUMsV0FBVyxFQUFFLFVBQVUsSUFBSTtZQUcxQixTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUV4RixJQUFJLEVBQUUsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLEdBQUc7Z0JBQ1QsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLENBQUMsQ0FBQyxDQUFBO1FBSU4sQ0FBQyxDQUFDLENBQUE7SUFFTixDQUFDLENBQUMsQ0FBQTtJQUdGLFFBQVEsQ0FBQyxTQUFTLEVBQUU7UUFHaEIsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLFVBQVUsSUFBSTtZQUN2RCxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLDJEQUEyRCxFQUFFLFVBQVUsSUFBSTtZQUMxRSxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLDBCQUEwQixFQUFFLFVBQVUsSUFBSTtZQUN6QyxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLFVBQVUsSUFBSTtZQUNuRCxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLDJDQUEyQyxFQUFFLFVBQVUsSUFBSTtZQUMxRCxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLFVBQVUsSUFBSTtZQUNyRSxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLDJCQUEyQixFQUFFLFVBQVUsSUFBSTtZQUMxQyxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO1FBQ0YsRUFBRSxDQUFDLHFDQUFxQyxFQUFFLFVBQVUsSUFBSTtZQUNwRCxJQUFJLEVBQUUsQ0FBQztRQUNYLENBQUMsQ0FBQyxDQUFBO0lBRU4sQ0FBQyxDQUFDLENBQUE7QUFHTixDQUFDLENBQUMsQ0FBQTtBQUlGLEtBQUssQ0FBQyxVQUFVLElBQUk7SUFDaEIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNSLElBQUksRUFBRSxDQUFBO0lBQ1YsQ0FBQyxDQUFDLENBQUE7QUFFTixDQUFDLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBtb2NoYSBmcm9tIFwibW9jaGFcIjtcbmltcG9ydCAqIGFzIGNoYWkgZnJvbSBcImNoYWlcIjtcblxuaW1wb3J0IGNvdWNoYXV0aCBmcm9tIFwiLi4vaW5kZXhcIjtcblxuY29uc3QgcnBqID0gcmVxdWlyZSgncmVxdWVzdC1wcm9taXNlLWpzb24nKTtcbmNvbnN0IHNwYXduUG91Y2hkYlNlcnZlciA9IHJlcXVpcmUoJ3NwYXduLXBvdWNoZGItc2VydmVyJyk7XG5cbmNvbnN0IHRlc3Rwb3J0ID0gODc0MjtcblxuY29uc3QgdXNlcjAgPSB7XG4gICAgdXNlcjogJ3Rlc3R1c2VyMCcsXG4gICAgcGFzc3dvcmQ6ICd0ZXN0cGFzc3cwJyxcbiAgICBlbWFpbDogJ3Rlc3R1c2VyMEB0ZXN0LnRzdCdcbn1cblxuY29uc3QgdXNlcjEgPSB7XG4gICAgdXNlcjogJ3Rlc3R1c2VyMScsXG4gICAgcGFzc3dvcmQ6ICd0ZXN0cGFzc3cxJyxcbiAgICBlbWFpbDogJ3Rlc3R1c2VyMUB0ZXN0LnRzdCdcbn1cblxubGV0IGV4cGVjdCA9IGNoYWkuZXhwZWN0O1xuXG5cbmxldCBTZXJ2ZXI7XG5cblxuXG5sZXQgQ291Y2hBdXRoOiBjb3VjaGF1dGg7XG5cblxuXG5iZWZvcmUoZnVuY3Rpb24gKGRvbmUpIHtcbiAgICB0aGlzLnRpbWVvdXQoMjAwMDApO1xuICAgIHNwYXduUG91Y2hkYlNlcnZlcihcbiAgICAgICAge1xuICAgICAgICAgICAgcG9ydDogdGVzdHBvcnQsXG4gICAgICAgICAgICBiYWNrZW5kOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbmZpZzoge1xuICAgICAgICAgICAgICAgIGFkbWluczogeyBcImFkbWludXNlclwiOiBcImFkbWlucGFzc1wiIH0sXG4gICAgICAgICAgICAgICAgZmlsZTogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2c6IHtcbiAgICAgICAgICAgICAgICBmaWxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBsZXZlbDogJ2luZm8nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvciwgc2VydmVyKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBTZXJ2ZXIgPSBzZXJ2ZXJcblxuXG4gICAgICAgICAgICAgICAgQ291Y2hBdXRoID0gbmV3IGNvdWNoYXV0aCh7XG4gICAgICAgICAgICAgICAgICAgIGhvc3RuYW1lOiAnbG9jYWxob3N0JyxcbiAgICAgICAgICAgICAgICAgICAgcHJvdG9jb2w6ICdodHRwJyxcbiAgICAgICAgICAgICAgICAgICAgcG9ydDogdGVzdHBvcnQsXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6ICdhZG1pbnVzZXInLFxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogJ2FkbWlucGFzcydcbiAgICAgICAgICAgICAgICB9KTtcblxuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKVxuICAgICAgICAgICAgICAgIH0sIDEwMDApXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cblxuXG5cblxuXG5cbn0pO1xuXG5cbmRlc2NyaWJlKFwidGVzdCBhcHBfbWFpblwiLCBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy50aW1lb3V0KDIwMDAwKTtcblxuICAgIGl0KFwidmVyaWZpY2F0ZSBwcmVzZW5jZSBvZiBhcHBfbWFpbiBkYlwiLCBmdW5jdGlvbiAoZG9uZSkge1xuXG5cbiAgICAgICAgcnBqLmdldChDb3VjaEF1dGgubXkoJ2FwcF9tYWluJykpLnRoZW4oZnVuY3Rpb24gKGQpIHtcblxuICAgICAgICAgICAgcnBqLnB1dChDb3VjaEF1dGgubXkoJ2FwcF9tYWluJykgKyAnL3Rlc3Rkb2N0b2JlcHJlc2VudDAnLCB7IF9pZDogJ3Rlc3Rkb2N0b2JlcHJlc2VudDAnLCBlZTogdHJ1ZSB9KS50aGVuKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLm9rO1xuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5hbignb2JqZWN0Jyk7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgICAgICAgICAgICBkb25lKEVycm9yKGVycikpO1xuICAgICAgICAgICAgfSlcblxuXG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGRvbmUoRXJyb3IoZXJyKSk7XG4gICAgICAgIH0pXG4gICAgfSk7XG5cbiAgICBpdChcInZlcmlmaWNhdGUgdGhhdCBhcHBfbWFpbiBkYiBpcyBwcml2YXRlXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKENvdWNoQXV0aC5teSgnYXBwX21haW4nKSlcbiAgICAgICAgcnBqLnB1dChDb3VjaEF1dGgucHVibGluayArICcvYXBwX21haW4vdGVzdGRvY25vdGJlcHJlc2VudDAnLCB7IF9pZDogJ3Rlc3Rkb2Nub3RiZXByZXNlbnQwJywgZWU6IHRydWUgfSkudGhlbihmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgZG9uZShFcnJvcihkKSk7XG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChlcnIpLnRvLmJlLm9rO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KVxuXG4gICAgfSk7XG5cblxuICAgIGl0KFwidmVyaWZpY2F0ZSBhZG1pbiB1c2VyXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgIC8vICAgIGNvbnNvbGUubG9nKENvdWNoQXV0aC5teSgnYXBwX21haW4nKSlcbiAgICAgICAgcnBqLmdldChDb3VjaEF1dGgubXkoJ191c2Vycy9vcmcuY291Y2hkYi51c2VyOicgKyAnYWRtaW51c2VyJykpLnRoZW4oZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5vaztcbiAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KCduYW1lJykudGhhdC5lcSgnYWRtaW51c2VyJyk7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgnZW1haWwnKTtcbiAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KCdyb2xlcycpLnRoYXQuaXMuYW4oJ2FycmF5Jyk7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgnZGInKS50aGF0LmlzLmFuKCdhcnJheScpO1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGVycikpO1xuICAgICAgICB9KVxuXG4gICAgfSk7XG5cblxufSk7XG5kZXNjcmliZShcImNyZWF0ZSBhIG5ldyBhcHBcIiwgZnVuY3Rpb24gKCkge1xuICAgIGl0KFwibWFpbiBhZG1pbiBhZGQgZmlyc3QgYXBwXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgIENvdWNoQXV0aC5jcmVhdGVhcHAoJ3Rlc3RhcHAnKS50aGVuKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uYmUub2s7XG5cbiAgICAgICAgICAgIGRvbmUoKVxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGVycikpO1xuICAgICAgICB9KVxuICAgIH0pXG59KVxuZGVzY3JpYmUoXCJ1c2Vyc1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoXCJyZWdpc3RyYXRpb25cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgc2xhdmU7XG5cbiAgICAgICAgaXQoXCJjcmVhdGUgYW4gdXNlclwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgQ291Y2hBdXRoLnJlZ2lzdGVyKHsgdXNlcm5hbWU6IHVzZXIwLnVzZXIsIHBhc3N3b3JkOiB1c2VyMC5wYXNzd29yZCwgZW1haWw6IHVzZXIwLmVtYWlsLCBhcHBfaWQ6ICd0ZXN0YXBwJyB9KS50aGVuKGZ1bmN0aW9uICgpIHtcblxuXG4gICAgICAgICAgICAgICAgcnBqLmdldChDb3VjaEF1dGgubXkoJ191c2Vycy9vcmcuY291Y2hkYi51c2VyOicgKyB1c2VyMC51c2VyKSkudGhlbihmdW5jdGlvbiAoZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5vaztcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ25hbWUnKS50aGF0LmVxKHVzZXIwLnVzZXIpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgnZW1haWwnKS50aGF0LmVxKHVzZXIwLmVtYWlsKTtcblxuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgncm9sZXMnKS50aGF0LmlzLmFuKCdhcnJheScpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZC5yb2xlc1swXSkudG8uYmUuZXEoJ3VzZXInKTtcblxuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgndHlwZScpLnRoYXQuZXEoJ3VzZXInKTtcblxuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgnZGInKS50aGF0LmlzLmFuKCdhcnJheScpO1xuXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkLmRiWzBdKS50by5oYXZlLnByb3BlcnR5KCdhcHBfaWQnKS50aGF0LmlzLmEoJ3N0cmluZycpLnRoYXQuZXEoJ3Rlc3RhcHAnKTtcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQuZGJbMF0pLnRvLmhhdmUucHJvcGVydHkoJ2RibmFtZScpLnRoYXQuaXMuYSgnc3RyaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkLmRiWzBdKS50by5oYXZlLnByb3BlcnR5KCdkYnR5cGUnKS50aGF0LmlzLmEoJ3N0cmluZycpLnRoYXQuZXEoJ21pbmUnKTtcblxuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZC5kYlswXSkudG8uaGF2ZS5wcm9wZXJ0eSgncm9sZXMnKS50aGF0LmlzLmFuKCdhcnJheScpO1xuICAgICAgICAgICAgICAgICAgICBleHBlY3QoZC5kYlswXS5yb2xlc1swXSkudG8uYmUuZXEoJ293bmVyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0KGQuZGJbMF0pLnRvLmhhdmUucHJvcGVydHkoJ3NsYXZlJykudGhhdC5pcy5hbignb2JqZWN0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkLmRiWzBdLnNsYXZlKS50by5oYXZlLnByb3BlcnR5KCd1c2VybmFtZScpLnRoYXQuaXMuYSgnc3RyaW5nJyk7XG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdChkLmRiWzBdLnNsYXZlKS50by5oYXZlLnByb3BlcnR5KCdwYXNzd29yZCcpLnRoYXQuaXMuYSgnc3RyaW5nJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgc2xhdmUgPSBkLmRiWzBdLnNsYXZlO1xuICAgICAgICAgICAgICAgICAgICBkb25lKCk7XG5cblxuXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBkb25lKEVycm9yKGVycikpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKTtcbiAgICAgICAgICAgIH0pXG5cblxuXG4gICAgICAgIH0pXG5cbiAgICAgICAgaXQoXCJjaGVjayBzbGF2ZVwiLCBmdW5jdGlvbiAoZG9uZSkge1xuXG4gICAgICAgICAgICBycGouZ2V0KENvdWNoQXV0aC5teSgnX3VzZXJzL29yZy5jb3VjaGRiLnVzZXI6JyArIHNsYXZlLnVzZXJuYW1lKSkudGhlbigoZCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLm9rO1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ25hbWUnKS50aGF0LmVxKHNsYXZlLnVzZXJuYW1lKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KCdyb2xlcycpLnRoYXQuaXMuYW4oJ2FycmF5Jyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGQucm9sZXNbMF0pLnRvLmJlLmVxKCdzbGF2ZScpO1xuXG5cbiAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uaGF2ZS5wcm9wZXJ0eSgnYXBwJykudGhhdC5pcy5hbignb2JqZWN0Jyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGQuYXBwKS50by5oYXZlLnByb3BlcnR5KCdkYicpLnRoYXQuaXMuYSgnc3RyaW5nJyk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGQuYXBwKS50by5oYXZlLnByb3BlcnR5KCd1c2VyJykudGhhdC5pcy5hKCdzdHJpbmcnKTtcblxuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KCdkYnR5cGUnKS50aGF0LmlzLmEoJ3N0cmluZycpLnRoYXQuZXEoJ3VzZXJzbGF2ZScpO1xuXG4gICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoJ3R5cGUnKS50aGF0LmlzLmEoJ3N0cmluZycpLnRoYXQuZXEoJ3VzZXInKTtcblxuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICBkb25lKEVycm9yKGVycikpO1xuICAgICAgICAgICAgfSlcblxuXG5cbiAgICAgICAgfSlcblxuICAgICAgICBpdChcImNhbiBsb2dpblwiLCBmdW5jdGlvbiAoZG9uZSkge1xuXG5cbiAgICAgICAgICAgIENvdWNoQXV0aC5sb2dpbih7IHVzZXJuYW1lOiB1c2VyMC51c2VyLCBwYXNzd29yZDogdXNlcjAucGFzc3dvcmQsIGFwcF9pZDogJ3Rlc3RhcHAnIH0pLnRoZW4oKCkgPT4ge1xuXG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIGRvbmUoRXJyb3IoZXJyKSk7XG4gICAgICAgICAgICB9KVxuXG5cblxuICAgICAgICB9KVxuXG4gICAgfSlcblxuXG4gICAgZGVzY3JpYmUoXCJtYWNoaW5lXCIsIGZ1bmN0aW9uICgpIHtcblxuXG4gICAgICAgIGl0KFwiY3JlYXRlIGEgbWFjaGluZSBmb3IgYW4gYXBwIHN1YnNjcmliZWRcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgaXQoXCJjYW4ndCBjcmVhdGUgYSBtYWNoaW5lIGZvciBhbiBhcHAgdGhhdCBub3Qgc3Vic2NyaWJlZCB5ZXRcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgaXQoXCJzaGFyZSBhIG1hY2hpbmUgdGhhdCBvd25cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgaXQoXCJjYW4ndCBzaGFyZSBhIG1hY2hpbmUgdGhhdCBub3Qgb3duXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG4gICAgICAgIGl0KFwiY2hhbmdlIGEgdXNlciByb2xlIGZvciBhIG1hY2hpbmUgdGhhdCBvd25cIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgaXQoXCJjYW4ndCBjaGFuZ2UgIGEgdXNlciByb2xlIGZvciBhIG1hY2hpbmUgdGhhdCBub3Qgb3duXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG4gICAgICAgIGl0KFwiZGVsZXRlIGEgbWFjaGluZSB0aGF0IG93blwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICAgICAgZG9uZSgpO1xuICAgICAgICB9KVxuICAgICAgICBpdChcImNhbid0IGRlbGV0ZSBhIG1hY2hpbmUgdGhhdCBub3Qgb3duXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgICAgICBkb25lKCk7XG4gICAgICAgIH0pXG5cbiAgICB9KVxuXG5cbn0pXG5cblxuXG5hZnRlcihmdW5jdGlvbiAoZG9uZSkge1xuICAgIFNlcnZlci5zdG9wKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZG9uZSgpXG4gICAgfSlcblxufSk7Il19
